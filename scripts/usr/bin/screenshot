#!/bin/bash
# only works on wayland
# tested on arch + sway
# taken from https://wiki.archlinux.org/index.php/Sway#Screen_capture

# sudo pacman -S jq wl-clipboard grim slurp

get_window() {
	swaymsg -t get_tree | jq -r '.. | select(.focused?) | .rect | "\(.x),\(.y) \(.width)x\(.height)"'
}

PARAMS=""
OUTPUT=" - | wl-copy -t image/png"
while (( "$#" )); do
  case "$1" in
    -f)
			OUTPUT="$(xdg-user-dir PICTURES)/$(date +'%Y-%m-%d_%H-%M-%S.png')"
      shift
      ;;
    -*|--*=) # unsupported flags
      echo "Error: Unsupported flag $1" >&2
      exit 1
      ;;
    *) # preserve positional arguments
      PARAMS="$PARAMS $1"
      shift
      ;;
  esac
done

FLAGS=
case $PARAMS in
	" window")
		FLAGS="-g \"$(get_window)\""
		;;
	" area")
		FLAGS="-g \"$(slurp)\""
		;;
# TODO: fix by moving this to "all" and adding a way of screenshotting screen only
	" screen" | *)
		;;
esac

eval "grim $FLAGS $OUTPUT"
